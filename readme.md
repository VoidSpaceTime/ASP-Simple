# 项目说明文档

## 项目概述

本项目采用领域驱动设计(DDD)架构，实现了一个模块化的服务系统。主要包含文章管理服务、文件管理服务等模块，并使用了现代化的技术栈和设计模式。

## 系统架构

系统采用微服务架构，主要由以下几个核心服务组成：

- **文章服务(PostService)** - 负责文章的创建、管理和发布流程
- **文件服务(FileService)** - 处理文件上传、存储和管理
- **配置服务** - 提供系统配置的集中管理

### 技术栈

- **.NET 8**: 系统基础框架
- **Entity Framework Core**: ORM框架
- **MassTransit/RabbitMQ**: 消息队列与事件驱动通信
- **JWT**: 身份认证
- **SQL Server**: 关系型数据库
- **Swagger**: API文档

## 领域模型

### 文章服务领域模型

#### Post (文章)

文章是系统的核心聚合根之一，包含以下主要属性：

- **基本信息**: 标题(Title)、内容(Content)、用户ID(UserId)
- **发布状态**: 通过(Pass)、等待(Wait)、失败(Fail)
- **分类与标签**: 分类列表(Categories)、标签列表(Tags)
- **媒体资源**: 封面图片(CoverImageUrl)、文件列表(Files)
- **评论管理**: 关联的评论集合(Comments)

文章实体提供了以下主要操作：

- 创建文章：`Create`方法
- 添加评论：`AddComment`方法
- 更新内容：`UpdateContent`方法
- 更新标题：`UpdateTitle`方法
- 更新状态：`UpdateStatus`、`UpdateStatusPass`、`UpdateStatusWait`、`UpdateStatusFail`等方法

### 文件服务领域模型

#### UploadedItem (上传文件)

表示已上传的文件，主要属性包括：

- 文件路径(Path)
- 文件大小(FileSizeInBytes)
- 文件哈希值(FileSHA256Hash)
- 文件URL(RemoteUrl, BackupUrl)

文件上传服务通过SHA256哈希值和文件大小检测重复文件，避免重复存储。

## 服务架构

### 领域服务

#### FileDomainService

文件领域服务主要负责文件上传逻辑，实现了：

- 文件查重：通过比对SHA256哈希值和文件大小
- 文件存储：支持多存储策略(本地备份和远程存储)
- 文件路径规划：使用年/月/日/哈希值的层级结构

### 基础设施

系统使用了依赖注入框架进行组件管理，主要配置包括：

- 数据库上下文注册
- 消息总线配置(MassTransit/RabbitMQ)
- JWT认证配置
- CORS跨域配置
- Swagger API文档配置

## 设计模式与原则

本项目应用了多种设计模式和原则：

1. **领域驱动设计(DDD)**: 使用聚合根、实体、领域服务等概念
2. **仓储模式**: 抽象数据访问层
3. **工作单元模式**: 通过`UnitOfWorkFilter`实现
4. **依赖注入**: 采用.NET内置DI容器
5. **CQRS原则**: 分离命令和查询职责

## 项目扩展点

根据代码中的注释，系统计划扩展以下功能：

- 文章服务：添加SEO相关属性、阅读统计、权限管理等
- 文件服务：完善备份存储机制
- 配置服务：支持更多配置源

## 最佳实践

- **实体设计**: 使用Record类型定义实体，提高不可变性
- **领域服务**: 领域服务负责协调实体和值对象，不直接执行数据库操作
- **配置管理**: 采用数据库配置提供程序，实现配置集中管理
- **安全性**: 使用JWT进行身份验证和授权
